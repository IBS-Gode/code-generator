#set($appName=${APP.getName().toLowerCase()})
#set($adminAppName=${CodeAppUtil.adminAppName($APP).toLowerCase()})
version: '3.7'
volumes:
  ${appName}_data:
    name: ${appName}_data
  db_${appName}:
    name: db_${appName}
services:
  ${appName}-service:
    image: ${appName}_app_docker:latest
    volumes:
      - ${appName}_data:/var/lib/${appName}_data
    ports:
      - 9990:9990
    depends_on:
#if($APP.features.jpaStoreRequired)
      - jpa-mySql-database_${appName}
#end
#if(${APP.features.mongoRequired})
      - ${appName}_mongo
#end
#if(${APP.features.cassandraRequired})
      -${adminAppName}-cassandra
#end
      - ${adminAppName}-service
    environment:
#if(${APP.features.jpaStoreRequired})
      - gode.datastore.jpa.datasource.username=dbuser
      - gode.datastore.jpa.driver=com.mysql.cj.jdbc.Driver
      - gode.datastore.jpa.datasource.password=dbpass
      - gode.datastore.jpa.datasource.url=jdbc:mysql://jpa-mySql-database_${appName}/${appName}_db?useSSL=false&allowPublicKeyRetrieval=true
      - gode.datastore.jpa.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
#end
#if(${APP.features.mongoRequired})
      - gode.datastore.mongodb.uri=mongodb://root:admin123@${appName}_mongo:27017/
      - gode.datastore.mongodb.database.name=myproject
#end
#if(${APP.features.cassandraRequired})
       - gode.datastore.cassandra.contact-points=${adminAppName}-cassandra
       - gode.datastore.cassandra.port=9042
       - gode.datastore.cassandra.username=cassandra
       - gode.datastore.cassandra.password=cassandra
#end
#if(${APP.features.elasticsearchRequired})
      - gode.datastore.elasticsearch.hosts=http://localhost:9200
      - gode.datastore.elasticsearch.user=user
      - gode.datastore.elasticsearch.password=user
      - gode.datastore.elasticsearch.cluster=cluster_one
#end
    networks:
      - ${appName}_net
#if($APP.features.jpaStoreRequired)
  jpa-mySql-database_${appName}:
    image: mysql/mysql-server:5.6
    volumes:
      - db_${appName}:/var/lib/db_${appName}
    restart: always
    ports:
      - 3308:3306
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_USER=dbuser
      - MYSQL_PASSWORD=dbpass
      - MYSQL_DATABASE=${appName}_db
      - MYSQL_ONETIME_PASSWORD=true
    networks:
      - ${appName}_net
#end
#if(${APP.features.mongoRequired})
   ${appName}_mongo:
     image: mongo:3.2.4
     ports:
     â€“ 27017:27017
     environment:
         - MONGO_INITDB_ROOT_USERNAME=root
         - MONGO_INITDB_ROOT_PASSWORD=admin123
     volumes:
       - data:/data/db/{appName}_mongo
     restart: always
     networks:
           - ${appName}_net
#end
#if(${APP.features.cassandraRequired})
  ${adminAppName}-cassandra:
      image: cassandra:3.11.1
      ports:
          - 9042:9042
      networks:
            - ${appName}_net
#end
  ${adminAppName}-service:
    image: ${adminAppName}_docker:latest
    ports:
      - 8890:9991
    networks:
      - ${appName}_net
networks:
  ${appName}_net:
    # Use a custom driver
    driver: bridge




